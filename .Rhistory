View(q_2022_12)
#RESUMEN de datos en formato SACBAD
#Por año hidrológico
q_hydro_year_estaciones <- q_rellenado %>%
group_by(hydro_year, Codigo_nacional) %>%
summarize(q_mean_hydro_year= sum(q_mean)) %>%
left_join(estaciones_caudal, by="Codigo_nacional")
View(q_hydro_year_estaciones)
# Por año hidrológico y por subcuencas
q_hydro_year_subcuencas<-q_hydro_year_estaciones %>%
group_by(Nombre_subcuenca, hydro_year) %>%
summarize(q_hydro_mean_subcuenca=mean(q_mean_hydro_year)) %>%
pivot_wider(names_from = hydro_year, values_from = q_hydro_mean_subcuenca)
View(q_hydro_year_subcuencas)
View(q_rellenado)
View(q_month_mean_subcuencas)
View(q_rellenado)
View(q_rellenado)
q_hydro_year_last_month <- q_rellenado %>%
filter(Month ==3)
View(q_hydro_year_last_month)
sum(is.na(q_hydro_year_last_month))
q_hydro_year_subcuencas<-q_hydro_year_last_month %>%
group_by(Nombre_subcuenca, hydro_year) %>%
summarize(q_mean_last_hydro_month=mean(q_mean, na.rm = TRUE)) %>%
pivot_wider(names_from = hydro_year, values_from = q_mean_last_hydro_month)
View(q_hydro_year_subcuencas)
View(q_hydro_year_estaciones)
write.csv2(q_hydro_year_subcuencas, paste0(getwd(), "/BBDD/q/DGA/procesado/q_last_hydro_month_subcuencas_1990_2022.csv"), row.names = FALSE)
write.csv2(q_hydro_year_last_month,  paste0(getwd(), "/BBDD/q/DGA/procesado/q_last_hydro_month_estaciones_1990_2022.csv"), row.names = FALSE)
q_nueva<-read.csv2(paste0(getwd(), "/BBDD/q/DGA/procesado/q_mensual_estaciones_SACBAD_1990_2023_12_rellenado.csv"))
Carac_gamma_ICE<-read.csv(paste0(getwd(),"/BBDD/coeficientes/DGA/ICE/Coeficientes_ICE_1991_2020.csv"))
Carac_gamma_ICE<-Corregir_Codigo_nacional(Carac_gamma_ICE)
q_nueva<-data.frame(q_nueva) %>%
Corregir_Codigo_nacional()
ICE3<-calcular_ICE(q_nueva , Carac_gamma_ICE, acumulacion = 3)
View(q_nueva)
q_medio_mensual<-q_nueva
rownames(q_medio_mensual)<-q_medio_mensual[,1]
q_medio_mensual[,1]
q_nueva %>% formatear_fecha()
q_nueva %>% formatear_fecha() %>%
select(date, Codigo_nacional, q_mean) %>%
pivot_wider(names_from= Codigo_nacional, values_from = q_mean)
q_nueva<-q_nueva %>% formatear_fecha() %>%
select(date, Codigo_nacional, q_mean) %>%
pivot_wider(names_from= Codigo_nacional, values_from = q_mean)
View(q_nueva)
ICE3<-calcular_ICE(q_nueva , Carac_gamma_ICE, acumulacion = 3)
q_medio_mensual<-q_nueva
rownames(q_medio_mensual)<-q_medio_mensual[,1]
View(q_medio_mensual)
q_nueva<-data.frame(q_nueva)
ICE3<-calcular_ICE(q_nueva , Carac_gamma_ICE, acumulacion = 3)
View(ICE3)
q_nueva<-read.csv2(paste0(getwd(), "/BBDD/q/DGA/procesado/q_mensual_estaciones_SACBAD_1990_2023_12_rellenado.csv"))
##ICE 6 Y 12 DGA
q_nueva<-q_nueva %>% formatear_fecha() %>%
select(date, Codigo_nacional, q_mean) %>%
pivot_wider(names_from= Codigo_nacional, values_from = q_mean)
q_nueva<-data.frame(q_nueva) %>%
Corregir_Codigo_nacional()
ICE3<-calcular_ICE(q_nueva , Carac_gamma_ICE, acumulacion = 3)
View(ICE3)
View(q_nueva)
q_nueva<-read.csv2(paste0(getwd(), "/BBDD/q/DGA/procesado/q_mensual_estaciones_SACBAD_1990_2023_12_rellenado.csv"))
##ICE 6 Y 12 DGA
View(q_nueva)
View(q_rellenado)
#METADATA estaciones seleccionadas SACBAD
estaciones_caudal<-read.csv(paste0(getwd(), "/BBDD/metadatos/DGA/estaciones_sacbad_caudal_calidad.csv"))
#Leer base de datos cruda antigua
q_2023_7<-read.csv("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/q/DGA/bruto/q_mean_DGA_1990_2023_7.csv")
#Para Sobreescribir con los datos más actualizados del año
q_2022_12<-q_2023_7 %>%
filter(Year<2023)
#Leer base de datos cruda nueva
q_2023_12<-read.csv("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/q/DGA/bruto/q_mean_DGA_2023_2023_12.csv")
colnames(q_2023_11)[5]<-"q_mean"
#Unir base de datos antigua con base de datos nueva
q<-rbind(q_2022_12,q_2023_11)
#Resumir Mensualmente y extraer estaciones SACBAD
q<-promedio_mensual(q_2023_7, filtro = 100)
q<-q %>%
left_join(estaciones_caudal, by="Codigo_nacional") %>%
filter(!is.na(Estacion)) %>%
mutate(hydro_year = if_else(Month >= 4, Year, Year - 1)) %>%
mutate(ID_subcuenca =
case_when(
Nombre_subcuenca == "Costeras entre Rios Quilimari y Petorca" ~ "CQP",
Nombre_subcuenca == "Petorca Medio" ~ "MP",
Nombre_subcuenca == "Rio Ligua Alto (Estero Alicahue)" ~ "UL",
Nombre_subcuenca == "Rio Ligua Bajo (Entre Estero Los Angeles y Desembocadura)" ~ "LL",
Nombre_subcuenca == "Rio Ligua Medio (entre Quebrada La Cerrada y Los Angeles)" ~ "ML",
Nombre_subcuenca == "Rio Petorca Alto (hasta despues Junta Rio Sobrante)" ~ "UP",
Nombre_subcuenca == "Rio Petorca Bajo (Entre Las Palmas y Desembocadura)" ~ "LP",
Nombre_subcuenca == "Rio Quilimari Entre Cajon Ingienillo y Desembocadura" ~ "LQ",
Nombre_subcuenca == "Rio Quilimari entre muro Embalse Culimo y Bajo Cajon Ingienillo" ~ "MQ",
Nombre_subcuenca == "Rio Quilimari hasta muro Embalse Culimo" ~ "UQ"
)) %>%
mutate(Name_subcuenca =
case_when(
ID_subcuenca == "CQP" ~ "Coastal Quilimari Petorca",
ID_subcuenca == "MP" ~ "Middle Petorca",
ID_subcuenca == "UL" ~ "Uqer Ligua",
ID_subcuenca == "LL" ~ "Lower Ligua",
ID_subcuenca == "ML" ~ "Middle Ligua",
ID_subcuenca == "UP" ~ "Uqer Petorca",
ID_subcuenca == "LP" ~ "Lower Petorca",
ID_subcuenca == "LQ" ~ "Lower Quilimari" ,
ID_subcuenca == "MQ" ~ "Middle Quilimari",
ID_subcuenca == "UQ" ~ "Uqer Quilimari"
))
#METADATA estaciones seleccionadas SACBAD
estaciones_caudal<-read.csv(paste0(getwd(), "/BBDD/metadatos/DGA/estaciones_sacbad_caudal_calidad.csv"))
#Leer base de datos cruda antigua
q_2023_7<-read.csv("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/q/DGA/bruto/q_mean_DGA_1990_2023_7.csv")
#Para Sobreescribir con los datos más actualizados del año
q_2022_12<-q_2023_7 %>%
filter(Year<2023)
#Leer base de datos cruda nueva
q_2023_12<-read.csv("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/q/DGA/bruto/q_mean_DGA_2023_2023_12.csv")
colnames(q_2023_11)[5]<-"q_mean"
#Unir base de datos antigua con base de datos nueva
q<-rbind(q_2022_12,q_2023_11)
#Resumir Mensualmente y extraer estaciones SACBAD
q<-promedio_mensual(q, filtro = 100)
q<-q %>%
left_join(estaciones_caudal, by="Codigo_nacional") %>%
filter(!is.na(Estacion)) %>%
mutate(hydro_year = if_else(Month >= 4, Year, Year - 1)) %>%
mutate(ID_subcuenca =
case_when(
Nombre_subcuenca == "Costeras entre Rios Quilimari y Petorca" ~ "CQP",
Nombre_subcuenca == "Petorca Medio" ~ "MP",
Nombre_subcuenca == "Rio Ligua Alto (Estero Alicahue)" ~ "UL",
Nombre_subcuenca == "Rio Ligua Bajo (Entre Estero Los Angeles y Desembocadura)" ~ "LL",
Nombre_subcuenca == "Rio Ligua Medio (entre Quebrada La Cerrada y Los Angeles)" ~ "ML",
Nombre_subcuenca == "Rio Petorca Alto (hasta despues Junta Rio Sobrante)" ~ "UP",
Nombre_subcuenca == "Rio Petorca Bajo (Entre Las Palmas y Desembocadura)" ~ "LP",
Nombre_subcuenca == "Rio Quilimari Entre Cajon Ingienillo y Desembocadura" ~ "LQ",
Nombre_subcuenca == "Rio Quilimari entre muro Embalse Culimo y Bajo Cajon Ingienillo" ~ "MQ",
Nombre_subcuenca == "Rio Quilimari hasta muro Embalse Culimo" ~ "UQ"
)) %>%
mutate(Name_subcuenca =
case_when(
ID_subcuenca == "CQP" ~ "Coastal Quilimari Petorca",
ID_subcuenca == "MP" ~ "Middle Petorca",
ID_subcuenca == "UL" ~ "Uqer Ligua",
ID_subcuenca == "LL" ~ "Lower Ligua",
ID_subcuenca == "ML" ~ "Middle Ligua",
ID_subcuenca == "UP" ~ "Uqer Petorca",
ID_subcuenca == "LP" ~ "Lower Petorca",
ID_subcuenca == "LQ" ~ "Lower Quilimari" ,
ID_subcuenca == "MQ" ~ "Middle Quilimari",
ID_subcuenca == "UQ" ~ "Uqer Quilimari"
))
View(q)
write.csv2(q,
paste0(getwd(),"/BBDD/q/DGA/procesado/q_mean_monthly_DGA_sacbad_1990_2023_12_crudo.csv"),
row.names = FALSE)
q<-read.csv2(paste0(getwd(),"/BBDD/q/DGA/procesado/q_mean_monthly_DGA_sacbad_1990_2023_12_crudo.csv"))
#Calcular valores promedio
q_month_mean_subcuencas <- q %>%
group_by(Year, Month, Nombre_subcuenca) %>%
summarize(q_month_mean_subcuenca = mean(q_mean, na.rm = TRUE))
options(scipen = 999)
q_month_mean<-q %>%
group_by(Year, Month) %>%
summarize(q_month_mean = mean(q_mean, na.rm = TRUE))
options(scipen = 0)
# Reemplazar NA's con datos promedio
q_month_mean_subcuencas <- q_month_mean_subcuencas  %>%
left_join(q_month_mean, by= c("Year", "Month")) %>%
mutate(q_month_mean_subcuenca = ifelse(is.na(q_month_mean_subcuenca), q_month_mean, q_month_mean_subcuenca)) %>%
select(-q_month_mean)
q_rellenado <- q  %>%
left_join(q_month_mean_subcuencas, by= c("Year", "Month", "Nombre_subcuenca")) %>%
mutate(q_mean = ifelse(is.na(q_mean), q_month_mean_subcuenca, q_mean)) %>%
select(-q_month_mean_subcuenca)
View(q_rellenado)
#Output
write.csv2(q_rellenado, paste0(getwd(), "/BBDD/q/DGA/procesado/q_mensual_estaciones_SACBAD_1990_2023_12_rellenado.csv"), row.names = FALSE)
#RESUMEN de datos en formato SACBAD
#Por año hidrológico
q_hydro_year_last_month <- q_rellenado %>%
filter(Month ==3)
write.csv2(q_hydro_year_last_month,  paste0(getwd(), "/BBDD/q/DGA/procesado/q_last_hydro_month_estaciones_1990_2022.csv"), row.names = FALSE)
# Por año hidrológico y por subcuencas
q_hydro_year_subcuencas<-q_hydro_year_last_month %>%
group_by(Nombre_subcuenca, hydro_year) %>%
summarize(q_mean_last_hydro_month=mean(q_mean, na.rm = TRUE)) %>%
pivot_wider(names_from = hydro_year, values_from = q_mean_last_hydro_month)
write.csv2(q_hydro_year_subcuencas, paste0(getwd(), "/BBDD/q/DGA/procesado/q_last_hydro_month_subcuencas_1990_2022.csv"), row.names = FALSE)
##ICE
q_nueva<-read.csv2(paste0(getwd(), "/BBDD/q/DGA/procesado/q_mensual_estaciones_SACBAD_1990_2023_12_rellenado.csv"))
#
View(q_nueva)
##ICE 6 Y 12 DGA
#q_nueva<-read.csv(paste0("C:/Users/56984/Documents/CCGUC/ANID_Sequias/BBDD/q/DGA/matriz/q_mean_DGA",fecha_fin,".csv"))
Carac_gamma_ICE<-read.csv(paste0(getwd(),"/BBDD/coeficientes/DGA/ICE/Coeficientes_ICE_1991_2020.csv"))
Carac_gamma_ICE<-Corregir_Codigo_nacional(Carac_gamma_ICE)
q_nueva<-q_nueva %>% formatear_fecha() %>%
select(date, Codigo_nacional, q_mean) %>%
pivot_wider(names_from= Codigo_nacional, values_from = q_mean)
q_nueva<-data.frame(q_nueva) %>%
Corregir_Codigo_nacional()
ICE3<-calcular_ICE(q_nueva , Carac_gamma_ICE, acumulacion = 3)
View(ICE3)
ICE6<-calcular_ICE(q_nueva , Carac_gamma_ICE, acumulacion = 6)
ICE12<-calcular_ICE(q_nueva , Carac_gamma_ICE, acumulacion = 12)
ICE3<-ICE3 %>%
mutate(date=row.names(ICE3)) %>%
mutate(
Month = as.numeric(substr(date, 1, 2)),
Year = as.numeric(substr(date, 4, 7)))  %>%
pivot_longer(
cols = c("05100001-3", "05110002-6", "05200001-7"),
names_to = "Codigo_nacional",
values_to = "ICE3") %>%
left_join(estaciones_sacbad,by="Codigo_nacional") %>%
mutate(hydro_year = if_else(Month >= 4, Year, Year - 1)) %>%
mutate(ID_subcuenca =
case_when(
Nombre_subcuenca == "Costeras entre Rios Quilimari y Petorca" ~ "CQP",
Nombre_subcuenca == "Petorca Medio" ~ "MP",
Nombre_subcuenca == "Rio Ligua Alto (Estero Alicahue)" ~ "UL",
Nombre_subcuenca == "Rio Ligua Bajo (Entre Estero Los Angeles y Desembocadura)" ~ "LL",
Nombre_subcuenca == "Rio Ligua Medio (entre Quebrada La Cerrada y Los Angeles)" ~ "ML",
Nombre_subcuenca == "Rio Petorca Alto (hasta despues Junta Rio Sobrante)" ~ "UP",
Nombre_subcuenca == "Rio Petorca Bajo (Entre Las Palmas y Desembocadura)" ~ "LP",
Nombre_subcuenca == "Rio Quilimari Entre Cajon Ingienillo y Desembocadura" ~ "LQ",
Nombre_subcuenca == "Rio Quilimari entre muro Embalse Culimo y Bajo Cajon Ingienillo" ~ "MQ",
Nombre_subcuenca == "Rio Quilimari hasta muro Embalse Culimo" ~ "UQ"
)) %>%
mutate(Name_subcuenca =
case_when(
ID_subcuenca == "CQP" ~ "Coastal Quilimari Petorca",
ID_subcuenca == "MP" ~ "Middle Petorca",
ID_subcuenca == "UL" ~ "Uqer Ligua",
ID_subcuenca == "LL" ~ "Lower Ligua",
ID_subcuenca == "ML" ~ "Middle Ligua",
ID_subcuenca == "UP" ~ "Uqer Petorca",
ID_subcuenca == "LP" ~ "Lower Petorca",
ID_subcuenca == "LQ" ~ "Lower Quilimari" ,
ID_subcuenca == "MQ" ~ "Middle Quilimari",
ID_subcuenca == "UQ" ~ "Uqer Quilimari"
))
ICE3<-ICE3 %>%
mutate(date=row.names(ICE3)) %>%
mutate(
Month = as.numeric(substr(date, 1, 2)),
Year = as.numeric(substr(date, 4, 7)))  %>%
pivot_longer(
cols = c("05100001-3", "05110002-6", "05200001-7"),
names_to = "Codigo_nacional",
values_to = "ICE3") %>%
left_join(estaciones_caudal,by="Codigo_nacional") %>%
mutate(hydro_year = if_else(Month >= 4, Year, Year - 1)) %>%
mutate(ID_subcuenca =
case_when(
Nombre_subcuenca == "Costeras entre Rios Quilimari y Petorca" ~ "CQP",
Nombre_subcuenca == "Petorca Medio" ~ "MP",
Nombre_subcuenca == "Rio Ligua Alto (Estero Alicahue)" ~ "UL",
Nombre_subcuenca == "Rio Ligua Bajo (Entre Estero Los Angeles y Desembocadura)" ~ "LL",
Nombre_subcuenca == "Rio Ligua Medio (entre Quebrada La Cerrada y Los Angeles)" ~ "ML",
Nombre_subcuenca == "Rio Petorca Alto (hasta despues Junta Rio Sobrante)" ~ "UP",
Nombre_subcuenca == "Rio Petorca Bajo (Entre Las Palmas y Desembocadura)" ~ "LP",
Nombre_subcuenca == "Rio Quilimari Entre Cajon Ingienillo y Desembocadura" ~ "LQ",
Nombre_subcuenca == "Rio Quilimari entre muro Embalse Culimo y Bajo Cajon Ingienillo" ~ "MQ",
Nombre_subcuenca == "Rio Quilimari hasta muro Embalse Culimo" ~ "UQ"
)) %>%
mutate(Name_subcuenca =
case_when(
ID_subcuenca == "CQP" ~ "Coastal Quilimari Petorca",
ID_subcuenca == "MP" ~ "Middle Petorca",
ID_subcuenca == "UL" ~ "Uqer Ligua",
ID_subcuenca == "LL" ~ "Lower Ligua",
ID_subcuenca == "ML" ~ "Middle Ligua",
ID_subcuenca == "UP" ~ "Uqer Petorca",
ID_subcuenca == "LP" ~ "Lower Petorca",
ID_subcuenca == "LQ" ~ "Lower Quilimari" ,
ID_subcuenca == "MQ" ~ "Middle Quilimari",
ID_subcuenca == "UQ" ~ "Uqer Quilimari"
))
View(estaciones_caudal)
ICE6<-ICE6 %>%
mutate(date=row.names(ICE6)) %>%
mutate(
Month = as.numeric(substr(date, 1, 2)),
Year = as.numeric(substr(date, 4, 7)))  %>%
pivot_longer(
cols = c("05100001-3", "05110002-6", "05200001-7"),
names_to = "Codigo_nacional",
values_to = "ICE6") %>%
left_join(estaciones_caudal,by="Codigo_nacional") %>%
mutate(hydro_year = if_else(Month >= 4, Year, Year - 1)) %>%
mutate(ID_subcuenca =
case_when(
Nombre_subcuenca == "Costeras entre Rios Quilimari y Petorca" ~ "CQP",
Nombre_subcuenca == "Petorca Medio" ~ "MP",
Nombre_subcuenca == "Rio Ligua Alto (Estero Alicahue)" ~ "UL",
Nombre_subcuenca == "Rio Ligua Bajo (Entre Estero Los Angeles y Desembocadura)" ~ "LL",
Nombre_subcuenca == "Rio Ligua Medio (entre Quebrada La Cerrada y Los Angeles)" ~ "ML",
Nombre_subcuenca == "Rio Petorca Alto (hasta despues Junta Rio Sobrante)" ~ "UP",
Nombre_subcuenca == "Rio Petorca Bajo (Entre Las Palmas y Desembocadura)" ~ "LP",
Nombre_subcuenca == "Rio Quilimari Entre Cajon Ingienillo y Desembocadura" ~ "LQ",
Nombre_subcuenca == "Rio Quilimari entre muro Embalse Culimo y Bajo Cajon Ingienillo" ~ "MQ",
Nombre_subcuenca == "Rio Quilimari hasta muro Embalse Culimo" ~ "UQ"
)) %>%
mutate(Name_subcuenca =
case_when(
ID_subcuenca == "CQP" ~ "Coastal Quilimari Petorca",
ID_subcuenca == "MP" ~ "Middle Petorca",
ID_subcuenca == "UL" ~ "Uqer Ligua",
ID_subcuenca == "LL" ~ "Lower Ligua",
ID_subcuenca == "ML" ~ "Middle Ligua",
ID_subcuenca == "UP" ~ "Uqer Petorca",
ID_subcuenca == "LP" ~ "Lower Petorca",
ID_subcuenca == "LQ" ~ "Lower Quilimari" ,
ID_subcuenca == "MQ" ~ "Middle Quilimari",
ID_subcuenca == "UQ" ~ "Uqer Quilimari"
))
ICE12<-ICE12 %>%
mutate(date=row.names(ICE12)) %>%
mutate(
Month = as.numeric(substr(date, 1, 2)),
Year = as.numeric(substr(date, 4, 7)))  %>%
pivot_longer(
cols = c("05100001-3", "05110002-6", "05200001-7"),
names_to = "Codigo_nacional",
values_to = "ICE12") %>%
left_join(estaciones_caudal,by="Codigo_nacional") %>%
mutate(hydro_year = if_else(Month >= 4, Year, Year - 1)) %>%
mutate(ID_subcuenca =
case_when(
Nombre_subcuenca == "Costeras entre Rios Quilimari y Petorca" ~ "CQP",
Nombre_subcuenca == "Petorca Medio" ~ "MP",
Nombre_subcuenca == "Rio Ligua Alto (Estero Alicahue)" ~ "UL",
Nombre_subcuenca == "Rio Ligua Bajo (Entre Estero Los Angeles y Desembocadura)" ~ "LL",
Nombre_subcuenca == "Rio Ligua Medio (entre Quebrada La Cerrada y Los Angeles)" ~ "ML",
Nombre_subcuenca == "Rio Petorca Alto (hasta despues Junta Rio Sobrante)" ~ "UP",
Nombre_subcuenca == "Rio Petorca Bajo (Entre Las Palmas y Desembocadura)" ~ "LP",
Nombre_subcuenca == "Rio Quilimari Entre Cajon Ingienillo y Desembocadura" ~ "LQ",
Nombre_subcuenca == "Rio Quilimari entre muro Embalse Culimo y Bajo Cajon Ingienillo" ~ "MQ",
Nombre_subcuenca == "Rio Quilimari hasta muro Embalse Culimo" ~ "UQ"
)) %>%
mutate(Name_subcuenca =
case_when(
ID_subcuenca == "CQP" ~ "Coastal Quilimari Petorca",
ID_subcuenca == "MP" ~ "Middle Petorca",
ID_subcuenca == "UL" ~ "Uqer Ligua",
ID_subcuenca == "LL" ~ "Lower Ligua",
ID_subcuenca == "ML" ~ "Middle Ligua",
ID_subcuenca == "UP" ~ "Uqer Petorca",
ID_subcuenca == "LP" ~ "Lower Petorca",
ID_subcuenca == "LQ" ~ "Lower Quilimari" ,
ID_subcuenca == "MQ" ~ "Middle Quilimari",
ID_subcuenca == "UQ" ~ "Uqer Quilimari"
))
View(ICE12)
write.csv2(ICE3, paste0(getwd(),"/BBDD/indicadores/ICE/ICE3/ICE3_estaciones_monthly_1991_2023.csv"), row.names=FALSE)
write.csv2(ICE6, paste0(getwd(),"/BBDD/indicadores/ICE/ICE6/ICE6_estaciones_monthly_1991_2023.csv"), row.names=FALSE)
write.csv2(ICE12, paste0(getwd(),"/BBDD/indicadores/ICE/ICE12/ICE12_estaciones_monthly_1991_2023.csv"), row.names=FALSE)
#Extraer el valor del último mes del año hidrológico (marzo)
ICE6_last_month <- ICE6 %>% filter(Month ==3) %>% select(hydro_year, ID_subcuenca, Name_subcuenca, ICE6)
ICE12_last_month <- ICE12 %>% filter(Month ==3) %>% select(hydro_year, ID_subcuenca, Name_subcuenca, ICE12)
ICE3_last_month <- ICE3 %>% filter(Month ==3) %>% select(hydro_year, ID_subcuenca, Name_subcuenca, ICE3)
write.csv2(ICE3_last_month, "C:/Users/56984/Documents/CCGUC/SACBAD/ICE/ICE3/ICE3_estaciones_last_month_1991_2022.csv", row.names=FALSE)
write.csv2(ICE6_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE6/ICE6_estaciones_last_month_1991_2022.csv"), row.names=FALSE)
write.csv2(ICE12_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE12/ICE12_estaciones_last_month_1991_2022.csv"), row.names=FALSE)
ICE6_resumen_last_month<-ICE6_last_month %>% pivot_wider(names_from = hydro_year, values_from = ICE6)
ICE12_resumen_last_month<-ICE12_last_month %>% pivot_wider(names_from = hydro_year, values_from = ICE12)
ICE3_resumen_last_month<-ICE3_last_month %>% pivot_wider(names_from = hydro_year, values_from = ICE3)
View(ICE3_resumen_last_month)
ICE6_resumen_last_month<-ICE6_last_month %>% pivot_wider(names_from = hydro_year, values_from = ICE6)
ICE12_resumen_last_month<-ICE12_last_month %>% pivot_wider(names_from = hydro_year, values_from = ICE12)
write.csv2(ICE3_resumen_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE3/ICE3_resumen_last_month_1991_2022.csv"), row.names=FALSE)
write.csv2(ICE6_resumen_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE6/ICE6_resumen_last_month_1991_2022.csv"), row.names=FALSE)
write.csv2(ICE12_resumen_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE12/ICE12_resumen_last_month_1991_2022.csv"), row.names=FALSE)
write.csv2(ICE3_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE3/ICE3_estaciones_last_month_1991_2022.csv"), row.names=FALSE)
write.csv2(ICE6_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE6/ICE6_estaciones_last_month_1991_2022.csv"), row.names=FALSE)
write.csv2(ICE12_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE12/ICE12_estaciones_last_month_1991_2022.csv"), row.names=FALSE)
ICE3_last_month <- ICE3 %>% filter(Month ==3)
ICE6_last_month <- ICE6 %>% filter(Month ==3)
ICE12_last_month <- ICE12 %>% filter(Month ==3)
View(ICE3)
View(ICE3_last_month)
write.csv2(ICE3_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE3/ICE3_estaciones_last_month_1991_2022.csv"), row.names=FALSE)
write.csv2(ICE6_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE6/ICE6_estaciones_last_month_1991_2022.csv"), row.names=FALSE)
write.csv2(ICE12_last_month, paste0(getwd(),"/BBDD/indicadores/ICE/ICE12/ICE12_estaciones_last_month_1991_2022.csv"), row.names=FALSE)
#METADATA estaciones seleccionadas SACBAD
estaciones_caudal<-read.csv(paste0(getwd(), "/BBDD/metadatos/DGA/estaciones_sacbad_caudal_calidad.csv"))
#Leer base de datos cruda antigua
q_2023_7<-read.csv("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/q/DGA/bruto/q_mean_DGA_1990_2023_7.csv")
#Para Sobreescribir con los datos más actualizados del año
q_2022_12<-q_2023_7 %>%
filter(Year<2023)
#Leer base de datos cruda nueva
q_2023_12<-read.csv("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/q/DGA/bruto/q_mean_DGA_2023_2023_12.csv")
colnames(q_2023_11)[5]<-"q_mean"
#Unir base de datos antigua con base de datos nueva
q<-rbind(q_2022_12,q_2023_11)
write.csv2(q , paste0(getwd(), "C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/q/DGA/bruto/q_mean_DGA_1990_2023_12.csv") , row.names = F)
write.csv2(q , paste0(getwd(), "/BBDD/q/DGA/bruto/q_mean_DGA_1990_2023_12.csv") , row.names = F)
View(q)
View(estaciones_caudal)
q_sacbad <- q %>%
filter(Codigo_nacional %in% codigo_nacional_values)
codigo_nacional_values <- estaciones_caudal$Codigo_nacional
q_sacbad <- q %>%
filter(Codigo_nacional %in% codigo_nacional_values)
View(q_sacbad)
#Output base de datos cruda diaria
write.csv2(q_sacbad , paste0(getwd(), "/BBDD/q/DGA/bruto/q_daily_mean_DGA_1990_2023_12.csv") , row.names = F)
pp_DGA_diaria<-read.csv("C:/Users/56984/Documents/CCGUC/WebScraping/BBDD/pp/DGA/bruto/antiguos/pp_DGA_1950_2023_8.csv")
View(pp_DGA_diaria)
pp_DGA_diaria<-pp_DGA_diaria %>% filter(Year >1989)
pp_DGA_diaria<-pp_DGA_diaria %>% filter(Year <2023)
#Cargar METADATA de estaciones seleccionadas proyecto SACBAD
estaciones_sacbad_pp<-read.csv2(paste0(getwd(), "/BBDD/metadatos/DGA+DMC/estaciones_sacbad_calidad_pp_70%.csv"))
codigo_nacional_values <- estaciones_sacbad_pp$Codigo_nacional
pp_DGA_diaria <- pp_DGA_diaria %>%
filter(Codigo_nacional %in% codigo_nacional_values)
View(pp_DGA_diaria)
sum(is.na(pp_DGA_diaria))
View(pp_DGA_diaria)
write.csv2(pp_DGA_diaria, paste0(getwd(), "/BBDD/pp/DGA/bruto/pp_DGA_1990_2022_12_crudo.csv"), row.names=F)
View(estaciones_sacbad_pp)
pp_DGA_1990_2022<-read.csv2( paste0(getwd(), "/BBDD/pp/DGA/bruto/pp_DGA_1990_2022_12_crudo.csv"))
#Cargar METADATA de estaciones seleccionadas proyecto SACBAD
estaciones_sacbad_pp<-read.csv2(paste0(getwd(), "/BBDD/metadatos/DGA+DMC/estaciones_sacbad_calidad_pp_70%.csv"))
#Cargar los ultimos datos de precipitacion
pp_DGA_2023_11<-read.csv(paste0(getwd(), "/BBDD/pp/DGA/bruto/pp_DGA_2023_2023_11.csv"))
pp_DGA_1990_2022<-read.csv2( paste0(getwd(), "/BBDD/pp/DGA/bruto/pp_DGA_1990_2022_12_crudo.csv"))
View(pp_DGA_1990_2022)
View(pp_DGA_2023_11)
pp_DGA<-rbind(pp_DGA_1990_2022, pp_DGA_2023_11)
View(pp_DGA_2023_11)
codigo_nacional_values <- estaciones_sacbad_pp$Codigo_nacional
pp_DGA_2023_11 %>% filter(Codigo_nacional %in% codigo_nacional_values)
pp_DGA_2023_11<-pp_DGA_2023_11 %>% filter(Codigo_nacional %in% codigo_nacional_values)
View(pp_DGA_2023_11)
pp_DGA<-rbind(pp_DGA_1990_2022, pp_DGA_2023_11)
View(pp_DGA)
length(levels(as.factori(pp_DGA$Codigo_nacional)))
length(levels(as.factor(pp_DGA$Codigo_nacional)))
write.csv2(pp_DGA, paste0(getwd(), "/BBDD/pp/DGA/bruto/pp_DGA_1990_2023_11.csv"), row.names = F)
pp_DMC_1989_2023<-read.csv("C:/Users/56984/Documents/CCGUC/WebScraping/BBDD/pp/DMC/matriz/pp_DMC_1989_2023.csv")
View(pp_DMC_1989_2023)
pp_DMC_1989_2023<-pp_DMC_1989_2023[,-1]
library(ggthemes)
library(zoo)
library(tidyverse)
library(SPEI)
library(zoo)
source(paste0(getwd(), "/1.Descargar/actualizar_bbdd.R"))
source(paste0(getwd(), "/2.Promediar_formatear/promedio_mensual.R"))
source(paste0(getwd(), "/4.Calcular_indicadores/SGI/calcular_SGI.R"))
source(paste0(getwd(), "/4.Calcular_indicadores/ICE/Codigo_base.R"))
source(paste0(getwd(), "/4.Calcular_indicadores/IPE/calcular_IPE.R"))
source(paste0(getwd(), "/0.Main/funciones_sacbad.R"))
pp_DMC_1989_2023<-Corregir_Codigo_nacional(pp_DMC_1989_2023)
}pp_DMC_1989_2023 %>% pivot_longer(cols= -c(Year, Month), names_to = Codigo_nacional, values_to = pp_month)
pp_DMC_1989_2023 %>% pivot_longer(cols= -c(Year, Month), names_to = Codigo_nacional, values_to = pp_month)
pp_DMC_1989_2023 %>% pivot_longer(cols= -c(Year, Month), names_to = "Codigo_nacional", values_to = "pp_month")
pp_DMC_1989_2023 <-pp_DMC_1989_2023 %>% pivot_longer(cols= -c(Year, Month), names_to = "Codigo_nacional", values_to = "pp_month")
pp_DMC_1989_2023 <-pp_DMC_1989_2023 %>% filter(Year>1989)
write.csv2(pp_DMC_1989_2023, "C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/pp/DMC/bruto/pp_DMC_monthly_1989_2023.csv")
codigo_nacional_values
pp_DMC_1989_2023 <- pp_DMC_1989_2023 %>% filter(Codigo_nacional %in% codigo_nacional_values)
write.csv2(pp_DMC_1989_2023, "C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/pp/DMC/bruto/pp_DMC_monthly_SACBAD_1989_2023_6.csv")
pp_DMC_2019_2022<-read.csv2("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/pp/DMC/bruto/pp_DMC_2019_2023_9.csv")
View(pp_DMC_2019_2022)
pp_DMC_2019_2022<-read.csv("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/pp/DMC/bruto/pp_DMC_2019_2023_9.csv")
pp_DMC_2019_2022<- pp_DMC_2019_2022 %>% filter(Year<2023)
pp_DMC_2019_2023_11<-read.csv("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/pp/DMC/bruto/pp_DMC_2023_2023_11.csv")
View(pp_DMC_2019_2023_11)
pp_DMC_2019_2023_11<-rbind(pp_DMC_2019_2022, pp_DMC_2019_2023_11)
View(pp_DMC_2019_2023_11)
pp_DMC_2019_2023_11<-pp_DMC_2019_2023_11 %>% filter(nchar(Codigo_nacional)>5)
write.csv2(pp_DMC_2019_2023_11, "C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/pp/DMC/bruto/pp_DMC_2019_2023_11.csv", row.names = F)
pp_DMC_2019_2023_11 <- pp_DMC_2019_2023_11 %>% filter(Codigo_nacional %in% codigo_nacional_values)
write.csv2(pp_DMC_2019_2023_11, "C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/pp/DMC/bruto/pp_DMC_SACBAD_2019_2023_11.csv", row.names = F)
niveles_daily_1950_2021<-read.csv("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/niveles_pozos/bruto/niveles_daily_1950_2021_crudo.csv")
View(niveles_daily_1950_2021)
niveles_daily_1950_2021<- niveles_daily_1950_2021 %>% filter(V1 > 1989)
colnames(niveles_daily_1950_2021)[c(2,3,4)]<-c("Year", "Month", "Day")
niveles_daily_1950_2021<- Corregir_codigo_nacional(niveles_daily_1950_2021)
niveles_daily_1950_2021<- Corregir_Codigo_nacional(niveles_daily_1950_2021)
niveles_daily_1950_2021<- niveles_daily_1950_2021 %>% pivot_longer(names_to = Codigo_nacional, values_to = nivel_pozo)
niveles_daily_1950_2021<- niveles_daily_1950_2021 %>% pivot_longer(cols = -c(Fecha, Year, Month, Day),names_to = "Codigo_nacional", values_to = "nivel_pozo")
write.csv2(niveles_daily_1950_2021,"C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/niveles_pozos/bruto/niveles_daily_1990_2021", row.names = FALSE)
write.csv2(niveles_daily_1950_2021,"C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/niveles_pozos/bruto/niveles_daily_1990_2021.csv", row.names = FALSE)
codigo_nacional_values <- estaciones_caudal$Codigo_nacional
estaciones_caudal<-read.csv(paste0(getwd(), "/BBDD/metadatos/DGA/estaciones_sacbad_caudal_calidad.csv"))
codigo_nacional_values <- estaciones_caudal$Codigo_nacional
niveles_daily_1950_2021 <- niveles_daily_1950_2021 %>% filter(Codigo_nacional %in% codigo_nacional_values)
View(niveles_daily_1950_2021)
codigo_nacional_values
read.csv2("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/niveles_pozos/bruto/niveles_daily_1990_2021.csv", row.names = FALSE)
read.csv2("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/niveles_pozos/bruto/otras estaciones/niveles_daily_1990_2021.csv")
niveles_daily_1990_2021<-read.csv2("C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/niveles_pozos/bruto/otras estaciones/niveles_daily_1990_2021.csv")
niveles_daily_1990_2021
View(niveles_daily_1990_2021)
estaciones_pozos<-read.csv(paste0(getwd(),"/BBDD/metadatos/DGA/estaciones_sacbad_pozos_calidad_29%.csv"))
codigo_nacional_values <- estaciones_pozos$Codigo_nacional
niveles_daily_1990_2021 %>% filter(Codigo_nacional %in% codigo_nacional_values)
niveles_daily_1990_2021_sacbad<-}niveles_daily_1990_2021 %>% filter(Codigo_nacional %in% codigo_nacional_values)
niveles_daily_1990_2021_sacbad<-niveles_daily_1990_2021 %>% filter(Codigo_nacional %in% codigo_nacional_values)
View(niveles_daily_1990_2021_sacbad)
write.csv2(niveles_daily_1990_2021_sacbad, "C:/Users/56984/Documents/CCGUC/SACBAD/SACBAD/BBDD/niveles_pozos/bruto/niveles_daily_1990_2019_crudo.csv", row.names = F)
